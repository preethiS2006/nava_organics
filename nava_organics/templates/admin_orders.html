{% extends 'base.html' %}
{% block title %}Admin Orders – Nava Organics{% endblock %}
{% block content %}
<section class="section">
  <h1 class="section-title">Manage Orders</h1>
  <table class="admin-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Customer Name</th>
        <th>Email</th>
        <th>Address</th>
        <th>Account No</th>
        <th>Products & Qty</th>
        <th>Total</th>
        <th>Status</th>
        <th>Payment</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for o in orders %}
        <tr>
          <td>{{ o.id }}</td>
          <td>{{ o.customer_name }}</td>
          <td>{{ o.customer_email }}</td>
          <td>{{ o.customer_address }}</td>
          <td>{{ o.account_number or '-' }}</td>
          <td>
            {% for item in o.items %}
              <div>{{ item.product_name }} (x{{ item.quantity }})</div>
            {% endfor %}
          </td>
          <td>₹{{ o.total_amount }}</td>
          <td>{{ o.status }}</td>
          <td>
            {% if o.payment_status.startswith('Payment Successful') %}
              <span class="payment-ok">Payment Successful</span>
            {% else %}
              {{ o.payment_status }}
            {% endif %}
          </td>
          <td>
            <form action="{{ url_for('admin_order_status', order_id=o.id) }}" method="post" class="order-actions">
              <button name="action" value="got" class="btn {% if o.status in ['Order Placed','Order Confirmed','Order Dispatched','Order Reached'] %}primary{% else %}ghost{% endif %}">Order Got</button>
              <button name="action" value="payment_received" class="btn {% if o.status in ['Order Confirmed','Order Dispatched','Order Reached'] %}primary{% else %}ghost{% endif %}">Confirmed</button>
              <button name="action" value="dispatched" class="btn {% if o.status in ['Order Dispatched','Order Reached'] %}primary{% else %}ghost{% endif %}">Dispatched</button>
              <button class="btn pale" disabled>Order Reached</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
